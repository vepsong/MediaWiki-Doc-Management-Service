<!-- # Настройка Zabbix-server для vm-1-monitoring-system -->

#### 6.2. Настройка Zabbix-server для vm-1-monitoring-system

1. Установка postgresql

   <details>
   <summary>Развернуть</summary> 
   
       # Обновление пакетов репозитория, установка postgresql, добавление в автозагрузку
       sudo apt update && sudo apt upgrade -y
       sudo apt install postgresql 
       sudo systemctl enable postgresql

       # Проверка установки: автозапуск и статус службы
       systemctl is-enabled postgresql
       systemctl status postgresql

   </details>  

2. [Установка zabbix 7.0 LTS](https://www.zabbix.com/download?zabbix=7.0&os_distribution=ubuntu&os_version=22.04&components=server_frontend_agent&db=pgsql&ws=nginx)  
Конфигурация: Zabbix 7.0 LTS, Ubuntu 22.04, Server, Frontend, Agent, Postgresql, Nginx

   <details>
   <summary>Развернуть</summary> 

       # Установка репозитория zabbix

       sudo wget https://repo.zabbix.com/zabbix/7.0/ubuntu/pool/main/z/zabbix-release/zabbix-release_latest+ubuntu22.04_all.deb

       sudo dpkg -i zabbix-release_latest+ubuntu22.04_all.deb

       sudo apt update

       # Установка Zabbix server, frontend, agent

       sudo apt install zabbix-server-pgsql zabbix-frontend-php php8.1-pgsql zabbix-nginx-conf zabbix-sql-scripts zabbix-agent

   </details>  

3. Настройка postgresql

   <details>
   <summary>Развернуть</summary> 

       # Создание новой роли
       sudo -u postgres createuser --pwprompt zabbix

       # Создание новой БД
       sudo -u postgres createdb -O zabbix zabbix

       # Импорт исходной схемы и данных в созданную БД
       zcat /usr/share/zabbix-sql-scripts/postgresql/server.sql.gz | sudo -u zabbix psql zabbix

       # Настройка /etc/zabbix/zabbix_server.conf
       DBPassword=password

       # Настройка /etc/zabbix/nginx.conf
       listen 8080;
       server_name example.com;


   </details>  

4. Проверка установки: запуск, добавление в автозапуск и статус службы

   <details>
   <summary>Развернуть</summary> 

       # Перезапуск службы
       systemctl restart zabbix-server zabbix-agent nginx php8.1-fpm

       # Добавление в автозапуск
       systemctl enable zabbix-server zabbix-agent nginx php8.1-fpm

       # Проверка
       systemctl is-enabled zabbix-server zabbix-agent nginx php8.1-fpm
       systemctl status zabbix-server zabbix-agent nginx php8.1-fpm

   </details>  


8. Основные команды для работы с PostgreSQL  

   <details>
   <summary>Развернуть</summary>  
      
       # Вход в аккаунт postgres
       sudo -i -u postgres
       # Открытие консоли postgres
       psql
       # Выход из консоли
       \\q
       # Выход из оболочки пользователя
       Ctrl+D
       # Просмотр статуса подключения
       \\conninfo
       # Список БД
       \\l
       # Подключение к БД
       \\c <имя БД>
       # Просмотр списка ролей (пользователей)
       \\du
       # Создать новую роль
       createuser --interactive
       # Создать новую БД
       createdb <имя БД>

       # Работа в консоли БД postgres подразумевает, что в linux существует такой же акк
       # После создания новой БД выходим из акк postgres > создаем в linux нового пользователя с именем БД > переключаемся на него > подключаемся к консоли
       sudo adduser <имя пользователя linux>
       sudo -i -u <имя созданного пользователя linux>
       psql

   </details> 
