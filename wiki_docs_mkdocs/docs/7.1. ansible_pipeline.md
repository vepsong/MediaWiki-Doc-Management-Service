# Ansible pipeline

## Changing the hostnames of all VMs

### Ansible

- Compare the current VM hostname with {{ showTooltip("**inventory.yaml**", "``~/repository_name/Ansible/inventory.yaml``") }} and change it if it differs.

        ansible-playbook playbook.yaml -i inventory.yaml --tags="change_hostname"

### Manual

    # Check the current VM hostname
    hostnamectl
    # Set a New Hostname
    hostnamectl set-hostname new-hostname


## Mounting external hard drives and initializing LVM

### Ansible

- Creating a ``disk partition``, ``physical volume``, ``volume group``, ``logical volume``, and a ``mount point`` in ``/opt`` directory
- Create an entry in ``/etc/fstab`` to automount the disk after a VM restart

        ansible-playbook playbook.yaml -i inventory.yaml --tags="mount_external_disks"

### Manual

- Display information about disks and partitions

        lsblk -f

- Partitioning the disk with new partitions

        # Example: fdisk /dev/vdb
        fdisk /dev/<device_name>

        # The "fdisk" console opens
            - g — create a GPT partition table
            - n — create a disk partition >
              > specify the partition number (usually 1) >
              > press Enter (when prompted about sectors)
            - w — save changes and exit

- Initializing the Physical Volume

        # Display information about disks and partitions
        lsblk -f

        # Create PV
        # Example: pvcreate /dev/vdb1
        pvcreate /dev/<partition_name>
            

- Creating a Volume Group

        # Create VG
        # Example: vgcreate vg-db-storage /dev/vdb1
        vgcreate <volume_group_name> /dev/<partition_name>

        # Check that the VG is created
        vgs

- Creating a Logical Volume

        # Check the number of physical extents
        vgdisplay

        # Create LV
        # Example: lvcreate -n lv-db -l 5119 vg-db-storage
        lvcreate -n <LV_name> -l <number of extents> <VG_name>

        # Check that the VG is created
        lvs

- Formatting the LV and creating an ext4 file system

        # Example: mkfs.ext4 /dev/vg-db-storage/lv-db
        mkfs.ext4 /dev/<VG_name>/<LV_name>

- Creating a Mount Point

        # Example: mkdir /opt/db_mount/
        mkdir /opt/<directory_name>/

- Mounting the LV

        # Example: mount /dev/vg-db-storage/lv-db /opt/db_mount/
        mount /dev/<VG_name>/<LV_name> <mount_point>

- Create an entry in ``/etc/fstab`` to automount the disk after a VM restart

        # Example: echo "/dev/vg-db-storage/lv-db /opt/db_mount/ ext4 defaults 0 0" | sudo tee -a /etc/fstab
        echo "/dev/<VG_name>/<LV_name> ext4 defaults 0 0" | sudo tee -a /etc/fstab

        # Check automount
        cat /etc/fstab or mount -a


## Unmounting external hard drives and deinitializing LVM (Optional)